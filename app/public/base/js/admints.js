
object_table();

	function create_list(data){
		var table = $('#table');
		for(var x in data){
			var tr = $('<tr>');
			tr.append($('<td>').text(data[x].car_resp_pers));
			tr.append($('<td>').text(data[x].number));
			tr.append($('<td>').text(data[x].color));
			tr.append($("<td><button type=\"button\" class=\"button_1677514707552\" id='obj_"+data[x].id+"' data-bs-toggle=\"modal\" data-bs-target=\"#mod_"+data[x].id+"\">Информация</button></td>")); 
            table.append(tr);
            fio = data[x].car_resp_pers.split(' ');
             var modal = $('<div class="modal fade" id="moddel_'+data[x].id+'" aria-hidden="true" aria-labelledby="modaldelquest" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"style="background-color:white"><div class="modal-header"><h5 class="modal-title" id="modaldelquest">Внимание</h5></div><div class="modal-body">Вы уверены что хотите удалить авто?</div><div class="modal-footer"><button type="button" class="registerdel" data-bs-target="modal" onclick="deleteTS('+data[x].id+')">Удалить</button><button class="registerred" data-bs-target="#mod_'+data[x].id+'" data-bs-toggle="modal" data-bs-dismiss="modal">Отмена</button></div></div></div></div>')
            table.append(modal);
             var modalinfo=$('<div  class="modal fade" id="mod_'+data[x].id+'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"><div  class="modal-dialog modal-dialog-centered" role="document"><div style="background-color:white" class="modal-content"><div class="modal-header"><h5 class="modal-title" id="exampleModalLabel">Информация о ТС</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button></div><div class="modal-body"><div class="col"  "><div class="row"><div class="col"><div class="row"><h5>номер ПЦН<input  type="text" class="registrpole" readonly value='+data[x].pcn_id+' /></h5></div><div class="row"><h5>Фамилия <input type="text" value="'+fio[0]+'" class="registrpole" readonly /></h5></div><div class="row"><h5>Имя <input type="text" value="'+fio[2]+'" class="registrpole" readonly/></h5></div><div class="row"><h5>Отчество <input type="text" value="'+fio[1]+'" class="registrpole"readonly/></h5></div><div class="row"><h5>Номер <input type="text" value="'+data[x].number+'" class="registrpole" readonly/></h5></div><div class="row"><h5>Цвет <input type="text" value="'+data[x].color+'" class="registrpole"readonly/></h5></div><div class="row"> <h5>Тип авто<input type="text" value="'+data[x].type+'" class="registrpole" readonly/></h5></div><div class="row"> <h5>Статус<input type="text" value="'+data[x].status+'" class="registrpole" readonly/></h5></div></div></div></div></div><div class="modal-footer"><button type="button" class="registerred" data-bs-target="#redmodal'+data[x].id+'" data-bs-toggle="modal" data-dismiss="modal">Редактировать</button><button type="button" class="registerdel" data-bs-target="#moddel_'+data[x].id+'" data-bs-toggle="modal" data-bs-dismiss="modal">Удалить</button></div></div></div></div>')
            table.append(modalinfo);
            table.append(redmodal(data,x));
		};
		$('#table').DataTable();

	}

	function redmodal(data,x)
	{
		fio = data[x].car_resp_pers.split(' ');
		f=fio[0];
		i=fio[1];
		o=fio[2];

		var mod =$('<div class="modal fade" id="redmodal'+data[x].id+'" tabindex="-1" role="dialog" aria-labelledby="modalredaria'+data[x].id+'" aria-hidden="true">                                                                                                                                                                                                                                                                                                                                                                                                                                  '+
		'     <div class="modal-dialog modal-dialog-centered" role="document">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        '+
		'         <div class="modal-content">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         '+
		'             <div class="modal-header">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      '+
		'                <h5 class="modal-title" id="modalredaria'+data[x].id+'">Редактирование ТС</h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                              '+
		'                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>                                                                                                                                                                                                                                                                                                                                                                                                                                                              '+
		'             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'             <div class="modal-body">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        '+
		'                 <div class="col" >                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'                     <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       '+
		'                         <div class="col">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   '+
		'                             <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               '+
		'                                 <h5>Фамилия                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 '+
		'                                <input id ="surnamer'+data[x].id+'" type="text" class="registrpole" value='+f+'  /></h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                                  '+
		'                             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'                             <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               '+
		'                                 <h5>Имя                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     '+
		'                                <input id ="namer'+data[x].id+'" type="text" class="registrpole" value='+i+' /></h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                                      '+
		'                             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'                             <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               '+
		'                                 <h5>Отчество                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                '+
		'                                <input id ="patronr'+data[x].id+'" type="text" class="registrpole" value='+o+' /></h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                                     '+
		'                             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'                             <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               '+
		'                                 <h5>Номер                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   '+
		'                                <input id ="numberr'+data[x].id+'" type="text" class="registrpole" value='+data[x].number+' /></h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                                    '+
		'                             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'                             <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            '+
		'                             <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               '+
		'                                 <h5>Тип авто                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                '+
		'                                <input id ="autotyper'+data[x].id+'" type="text" class="registrpole" value='+data[x].type+' /></h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                                  '+
		'                             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'                             <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               '+
		'                                 <h5>номер ПЦН                                                                                                                                                    '+
		'                                <input id ="pcnidr'+data[x].id+'" type="text" class="registrpole" value='+data[x].pcn_id+' /></h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                                      '+
		'                             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        '+
		'                                 <h5>Цвет                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    '+
		'                                <input id ="colorr'+data[x].id+'" type="text" class="registrpole" value='+data[x].color+' /></h5>                                                                                                                                                                                                                                                                                                                                                                                                                                                                     '+
		'                             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'                         </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              '+
		'                     </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  '+
		'                 </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      '+
		'             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'             <div class="modal-footer">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      '+
		'             <button id ="modalAddTS" class="registerbtn" style="width:50%"  onclick="updateTS( document.getElementById(\'surnamer'+data[x].id+'\').value,document.getElementById(\'namer'+data[x].id+'\').value,document.getElementById(\'patronr'+data[x].id+'\').value,document.getElementById(\'numberr'+data[x].id+'\').value,document.getElementById(\'colorr'+data[x].id+'\').value,document.getElementById(\'autotyper'+data[x].id+'\').value,document.getElementById(\'pcnidr'+data[x].id+'\').value,'+data[x].car_id+','+data[x].id+')" type="button" class="registerbtn" data-dismiss="modal">Сохранить</button> '+
		'              <button type="button" class="registerred" data-bs-target="#mod_'+data[x].id+'" data-bs-toggle="modal" data-bs-dismiss="modal">Отмена</button>                          '+

		'             </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '+
		'         </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              '+
		'     </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  '+
		' </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ');
		return mod;
	}

	function object_table()
	{	

		$.ajax({
            type: "POST",
            url: '/admints/ObjectInfo',
            success: function(data){
                if(data != "")
                {
                    Table = JSON.parse(data);
                    create_list(Table);
                }
                else
                {
                    create_list(null);
                }
            }
        }); 
	}


	function addNewTS(f,i,o,number,color,autotype,id)
	{
		$("#table tbody").remove();


		fion=f+" "+i+" "+o;
		$.ajax({
            type: "POST",
            url: '/admints/addAuto',
            data:{pcn_id:id,
            	  number:number,
            	  color: color,
            	  fio: fion,
                  autotype:autotype},
                  success:function(data){
						object_table();
                  }

        }); 

	}
	function updateTS(f,i,o,number,color,autotype,pcn_id,car,id)
	{
		$("#table tbody").remove();

		fion=f+" "+i+" "+o;

		$.ajax({
            type: "POST",
            url: '/admints/updateAuto',
            data:{
            	object_id:id,
        		car_id:car,
        		pcn_id:pcn_id,
        		number:number,
        		color:color,
        		car_resp_pers:fion,
        		type:autotype
			},
            success:function(data){
				object_table();
            }
        }); 
	}
	function deleteTS(data)
	{
		$.ajax({
            type: "POST",
            url: '/admints/deleteAuto',
            data:{object_id:data},
            success:function(data){
				object_table();
            }
        }); 
	}
